<%= form_for [@event, package] do |f| %>
<p class="formy">
  <%= f.label :name %>
  <%= f.text_field :name %>
  <% if package.errors[:name].present? %>
  <span class="error_details">
    <%= "Name " + package.errors[:name].join + "." %>
  </span>
  <% end %>
</p>
<p class="formy">
  <%= f.label :price %>
  <%= f.text_field :price %>
  <% if package.errors[:price].present? %>
  <span class="error_details">
    <%= "Price " + package.errors[:price].join + "." %>
  </span>
  <% end %>
</p>
<p><%= f.submit "Save Package", class: "btn btn-success" %></p>
<% end %>

<% unless package.new_record? %>
<h2>Package Perks</h2>

<table class="table table-striped table-hover table-sm">
  <tr>
    <thead class="thead-light">
      <th>Perk</th>
      <th>Options</th>
    </thead>
  </tr>
  <% @package.specs.each do |spec| %>
  <tr>
    <td><%= spec.perk.name %> <% if spec.qty > 1 %> (<%= spec.qty %>) <% end %></td>
    <td><%= button_to "Delete", spec, method: :delete, class: "btn btn-danger"  %></td>
  </tr>
  <% end %>
</table>

<%= form_for Spec.new do |s| %>
<%= s.hidden_field :package_id, value: @package.id %>
<p>
  <label>Perk <%= s.select(:perk_id, Perk.all.collect { |p| [ p.name, p.id ] }) %>
  </label>
</p>
<p>
  <label> Qty <%= s.number_field :qty, value: 1 %></label>
</p>
<p><%= s.submit "Add Perk", class: "btn btn-success" %></p>
<% end %>
<% end %>

<%# # TODO: Add validation of uniqeness with scope, so that you can only add each perk 1 time to each packages
# (if you need multiples, that's what the Qty is for)

<%# FIXME: If you try to add a Perk before you save your package, nothing happens. It should either not let you do it until you saved the other info, or it should give a warning or something.  %>